---
title: Vuexæ ¸å¿ƒæ¦‚å¿µçš„ç†è§£å’ŒåŸºæœ¬ç”¨æ³•
categories: æŠ€æœ¯ç¬”è®°
tags:
  - Vue
excerpt: Vuexæ ¸å¿ƒæ¦‚å¿µçš„ç†è§£å’ŒåŸºæœ¬ç”¨æ³•
cover: 'https://cdn.jsdelivr.net/gh/duogongneng/MyBlogImg@master/img20201105153540.png'
articleLink: 4e6a7035e5ae3605
date: 2020-11-05 11:38:36
---

## Vuex

å®ç°ç»„ä»¶å…¨å±€çŠ¶æ€ï¼ˆæ•°æ®ï¼‰ç®¡ç†çš„ä¸€ç§æœºåˆ¶,å¯ä»¥æ–¹ä¾¿çš„å®ç°ç»„ä»¶ä¹‹é—´çš„æ•°æ®å…±äº«ã€‚

æˆ‘ä»¬ä¹‹å‰çš„æ•°æ®ä¼ é€’çš„æ–¹å¼

- çˆ¶å‘å­ä¼ é€’æ•°æ®ï¼š `v-bind`å±æ€§ç»‘å®š
- å­å‘çˆ¶ä¼ é€’æ•°æ®ï¼š`v-on`äº‹ä»¶ç»‘å®š
- å…„å¼Ÿä¹‹é—´ä¼ é€’æ•°æ®ï¼š`$on`æ¥æ”¶æ•°æ® `$emit`å‘é€æ•°æ®

![Vuexä¼ é€’æ•°æ®](https://cdn.jsdelivr.net/gh/duogongneng/MyBlogImg@master/imgimgimage-20201105141437241.png)

å¦‚æœç´«è‰²å°çƒæƒ³ä¼ é€’æ•°æ®éœ€è¦èµ°å¾ˆå¤šè·¯ç»ï¼ˆè¿™æ ·å°±ä¼šå½±å“å¾ˆå¤šçš„ç»„ä»¶ï¼‰æ‰èƒ½åˆ°è¾¾

è€Œç°åœ¨æˆ‘ä»¬æœ‰äº†`Vuex`å¯ä»¥ç›´æ¥è¿›è¡Œä¼ é€’æ•°æ®

![Vuexä¼ é€’æ•°æ®](https://cdn.jsdelivr.net/gh/duogongneng/MyBlogImg@master/imgimage-20201105141622192.png)

æˆ‘ä»¬çš„ç´«è‰²å°çƒæƒ³åˆ†äº«æ•°æ® å¯ä»¥ç›´æ¥æŠŠæ•°æ®ä¼ é€’åˆ° `store`é‡Œé¢ ç„¶åè°æƒ³ä½¿ç”¨å¯ä»¥ç›´æ¥ä»`store`é‡Œé¢è¿›è¡Œè·å–å³å¯

### Vuexçš„å¥½å¤„

â¤ï¸èƒ½å¤Ÿåœ¨vuexä¸­é›†ä¸­ç®¡ç†å…±äº«çš„æ•°æ®,æ˜“äºå¼€å‘å’ŒåæœŸçš„ç»´æŠ¤

ğŸ§¡èƒ½å¤Ÿé«˜æ•ˆçš„å®ç°ç»„ä»¶é—´çš„æ•°æ®å…±ä»è€Œæé«˜å¼€å‘æ•ˆç‡

ğŸ’›å­˜å‚¨åœ¨vuexä¸­çš„æ•°æ®éƒ½æ˜¯å“åº”çš„èƒ½å¤Ÿå®æ—¶ä¿æŒæ•°æ®é¡µé¢çš„å…±äº«åŒæ­¥

### å¿«é€Ÿä½¿ç”¨

æˆ‘ä»¬éœ€è¦å®‰è£…Vuexçš„åŒ…

```
npx i vuex
```

ç„¶åæˆ‘ä»¬éœ€è¦å¯¼å…¥åˆ°é¡¹ç›®ä¸­

```
import Vuex from 'vuex'
// æ³¨å†Œ
Vue.use(Vuex)
```

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`store`å¯¹è±¡

```
const store = new Vuex.Store({
		//stateä¸­å­˜æ”¾çš„å°±æ˜¯å…¨å±€æ•°æ®
		state:{
			//æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ•°æ®
			num:0
		}
})
```

æˆ‘ä»¬å°†`store`å¯¹è±¡æŒ‚è½½åœ¨Vueå®ä¾‹ä¸Šé¢

```
new Vue({
	el:'#app',
	// å°†åˆ›å»ºçš„å…±äº«æ•°æ®å¯¹è±¡ï¼ŒæŒ‚è½½åˆ°Vueå®ä¾‹ä¸­
	// æ‰€æœ‰çš„ç»„ä»¶å°±å¯ä»¥ç›´æ¥ store ä¸­è·å–å…¨å±€çš„æ•°æ®
	store
})
```

### æ ¸å¿ƒæ¦‚å¿µ

#### State

æä¾›å”¯ä¸€çš„å…¬å…±æ•°æ®æº,æ‰€æœ‰çš„å…±äº«æ•°æ®éƒ½è¦ç»Ÿä¸€æ”¾åœ¨Storeçš„Stateä¸­è¿›è¡Œå­˜å‚¨

```
//åˆ›å»ºStoreæ•°æ®æº æä¾›å”¯ä¸€å…¬å…±æ•°æ®
const store = new Vuex.Store({
		state:{ count: 0 }
})
```

æˆ‘ä»¬å¦‚ä½•åœ¨ç»„ä»¶ä¸­è¿›è¡Œè®¿é—®å‘¢

æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨thisè¿›è¡Œè®¿é—®ï¼ˆç¬¬ä¸€ç§æ–¹å¼ï¼‰

```
this.$store.state.count
```

æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¼å…¥ `mapState`å‡½æ•°

```
import { mapState } = from 'vuex'
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆšæ‰å¯¼å…¥çš„`mapState`å‡½æ•° å°†å½“å‰ç»„ä»¶éœ€è¦çš„å…¨å±€æ•°æ®æ˜ å°„ä¸ºå½“å‰ç»„ä»¶çš„ `computed`è®¡ç®—å±æ€§

```
computed:{
	...mapState(['count'])
}
```

ç„¶åæˆ‘ä»¬å°±å¯ä»¥åœ¨ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ `count`å˜é‡äº†

#### Mutation

ç”¨äºå˜æ›´Storeä¸­çš„æ•°æ®

- åªèƒ½é€šè¿‡`mutation`è¿›è¡Œæ•°æ®çš„æ›´æ”¹ ä¸å¯ä»¥ç›´æ¥æ“ä½œ `store` ä¸­çš„æ•°æ®
- é€šè¿‡è¿™ç§æ–¹å¼è™½ç„¶ä¼šå˜çš„ç¨å¾®å¤æ‚ä¸€äº›ä½†æ˜¯å¯ä»¥é›†ä¸­ç›‘æ§æ‰€æœ‰æ•°æ®çš„å˜åŒ–

é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª `mutation`

```
const store = new Vuex.Store({
		state:{
			count:0
		},
		mutations:{
				// é‡Œé¢æˆ‘ä»¬å®šä¹‰æ–¹æ³•
				// æ¯”å¦‚æˆ‘ä»¬ç»™ count åŠ ä¸€çš„æ–¹æ³•
				add(state){
						state.count++
				}
		}
})
```

æˆ‘ä¹ˆæ€ä¹ˆåœ¨ç»„ä»¶ä¸­è§¦å‘è¿™ä¸ªåŠ ä¸€çš„æ–¹æ³•å‘¢

æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨è‡ªå·±ç»„ä»¶ä¸­çš„äº‹ä»¶ä¸­è°ƒç”¨

```
methods:{
		handle(){
				//è§¦å‘ mutations
				this.$store.commit('add')
		}
}
```

æˆ‘ä»¬è¿˜æœ‰åˆ«çš„è§¦å‘æ–¹å¼å—ï¼Ÿå½“ç„¶æœ‰

æˆ‘ä»¬å¯ä»¥å¯¼å…¥`mapMutations`å‡½æ•°

```
import { mapMutations } from 'vuex'
```

é€šè¿‡å¯¼å…¥çš„å‡½æ•°è¿›è¡Œæ˜ å°„ä¸ºç»„ä»¶çš„ `methods`æ–¹æ³•

```
methods:{
		// åœ¨æ•°ç»„ä¸­å¯ä»¥ä¼ é€’å¤šä¸ªæ–¹æ³•
		...mapMutations(['add','del'])
}
```

æˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥ä¼ é€’å‚æ•°çš„

##### ä¼ é€’å‚æ•°

æˆ‘ä»¬éœ€è¦åœ¨è°ƒç”¨çš„æ—¶å€™ä¼ é€’è¿‡å»

æˆ‘ä»¬éœ€è¦åœ¨`mutations`ä¸­è¿›è¡Œæ¥æ”¶

```
mutations:{
		// ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºstate
		// ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¼ é€’çš„å‚æ•°
		addN(state,step){
				state.count += step
		}
}
```

ç¬¬ä¸€ç§æ–¹å¼(æˆ‘ä»¬ç›´æ¥æŠŠå‚æ•°æ”¾åœ¨ç¬¬äºŒä¸ªå‚æ•°å³å¯)

```
this.$store.commit('addN',5)
```

ç¬¬äºŒç§æ–¹å¼

```
// åœ¨ç»„ä»¶ä¸­å¯¼å…¥ mapMutations æ–¹æ³•
methods:{
	...mapMutations(['addN']),
	//ç„¶åæˆ‘ä¹ˆå°±å¯ä»¥ç›´æ¥è¿›è¡Œè°ƒç”¨äº†
	// æœ¬è´¨ä¸Šå°±æ˜¯æ˜ å°„ä¸º æœ¬ç»„ä»¶è‡ªå·±çš„ æ–¹æ³•äº†
	btnClick(){
		// æˆ‘ä»¬è°ƒç”¨æ–¹æ³• ç„¶åä¼ é€’å‚æ•° ä¸º10
		this.addN(10)
	}
}
```

#### Action

**æˆ‘ä»¬ä¸èƒ½åœ¨ mutationså‡½æ•°ä¸­å»æ‰§è¡Œå¼‚æ­¥çš„æ“ä½œ**

æˆ‘ä»¬éœ€è¦å°†å¼‚æ­¥çš„æ“ä½œæ”¾åœ¨`action`ä¸­æ¥å¤„ç†

ä½ æƒ³é€šè¿‡å¼‚æ­¥çš„æ“ä½œä¿®æ”¹æ•°æ®ä½ å°±å¿…é¡»ä½¿ç”¨`action`ä¸å¯ä½¿ç”¨`mutations`

ä½†æ˜¯`Action`ä¸­è¿˜æ˜¯è¦é€šè¿‡è§¦å‘`mutations`æ¥é—´æ¥çš„æ›´æ”¹æ•°æ®

```
// å®šä¹‰action
const store = new Vuex.Store({
  state: {
    count: 0
  },
  mutations: {
    increment (state) {
      state.count++
    }
  },
  actions: {
    increment (context) {
    	// è¿™é‡Œå¯ä»¥å†™å¼‚æ­¥å¤„ç†é€»è¾‘
      context.commit('increment')
    }
  }
})
```

è§¦å‘ï¼ˆæˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶ä¸­ç›´æ¥è¿›è¡Œè°ƒç”¨ï¼‰

```
this.$store.dispatch('increment')
```

ä¹ä¸€çœ¼çœ‹ä¸Šå»æ„Ÿè§‰å¤šæ­¤ä¸€ä¸¾ï¼Œæˆ‘ä»¬ç›´æ¥åˆ†å‘ mutation å²‚ä¸æ›´æ–¹ä¾¿ï¼Ÿ

æˆ‘ä»¬å¯ä»¥åœ¨ action å†…éƒ¨æ‰§è¡Œ**å¼‚æ­¥**æ“ä½œï¼š

```
actions: {
  incrementAsync ({ commit }) {
    setTimeout(() => {
      commit('increment')
    }, 1000)
  }
}
```

æˆ‘ä¹ˆå¯ä»¥å¯¼å…¥ `mapActions`å‡½æ•°è¿›è¡Œè°ƒç”¨

```
import { mapActions } from 'vuex'
```

ç„¶åæˆ‘ä»¬å¯ä»¥ç›´æ¥æ˜ å°„ä¸ºæœ¬ç»„ä»¶çš„ `methods`å‡½æ•°

```
methods:{
		...mapActions(['incrementAsync'])
}
```

æˆ‘ä»¬å¯ä»¥ä¼ é€’å‚æ•° æ–¹å¼å’Œ `mutations`ä¸€æ ·

#### Getter

ç”¨äºå¯¹Storeä¸­çš„æ•°æ®è¿›è¡ŒåŠ å·¥å¤„ç†å½¢æˆæ–°çš„æ•°æ®

- å¯ä»¥å¯¹Storeä¸­å·²ç»å­˜åœ¨çš„æ•°æ®è¿›è¡ŒåŠ å·¥åå½¢æˆæ–°çš„æ•°æ®ç„¶åè¿”å›ï¼Œç±»ä¼¼è®¡ç®—å±æ€§
- Storeä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶å€™ ï¼ŒGetterä¼šè·Ÿç€å˜åŒ–

```
const store = new Vuex.Store({
  state: {
    todos: [
      { id: 1, text: '...', done: true },
      { id: 2, text: '...', done: false }
    ]
  },
  getters: {
    doneTodos: state => {
    	// è¿™é‡Œè¿”å›çš„æ˜¯å¤„ç†å¥½çš„æ•°æ®
      return state.todos.filter(todo => todo.done)
    }
  }
})
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡thisç›´æ¥åœ¨ç»„ä»¶ä¸­è¿›è¡Œè®¿é—®

```
this.$store.getters.doneTodos
```

æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡å¯¼å…¥`mapGetters`å‡½æ•°è¿›è¡Œè®¿é—®

```
import { mapGetters } from 'vuex'

computed:{
	// ä½¿ç”¨å¯¹è±¡å±•å¼€è¿ç®—ç¬¦å°† getter æ··å…¥ computed å¯¹è±¡ä¸­
	...mapGetters(['doneTodos'])
}
```

